<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Live Volume Bar</title>
</head>
<body style="font-family: sans-serif; margin: 20px;">
  <h3>Speak into your microphone</h3>
  <div id="volumeBar" style="width: 100%; background-color: #eee; border: 1px solid #ccc; height: 30px;">
    <div id="level" style="width: 0%; height: 100%; background-color: green;"></div>
  </div>
  <script>
    navigator.mediaDevices.getUserMedia({ audio: true })
      .then(function(stream) {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const source = audioContext.createMediaStreamSource(stream);
        const analyser = audioContext.createAnalyser();
        analyser.fftSize = 256;
        source.connect(analyser);

        const dataArray = new Uint8Array(analyser.frequencyBinCount);

        function updateVolume() {
          analyser.getByteFrequencyData(dataArray);
          let volume = dataArray.reduce((a, b) => a + b, 0) / dataArray.length;
          let percent = Math.min(100, volume / 2);
          document.getElementById("level").style.width = percent + "%";
          requestAnimationFrame(updateVolume);
        }

        updateVolume();
      })
      .catch(function(err) {
        console.error("Microphone access denied:", err);
        alert("Please allow microphone access to see the volume bar.");
      });
  </script>
</body>
</html>
